(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const h=document.getElementById("search-form"),f=document.getElementById("search-input"),u=document.querySelector("#today"),d=document.querySelector("#forecast"),i=document.getElementById("history"),p=document.getElementById("search-title"),l=document.getElementById("weather-img"),E=document.getElementById("temp"),g=document.getElementById("wind"),w=document.getElementById("humidity"),b=async t=>{try{const e=await fetch("/api/weather/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cityName:t})});if(!e.ok)throw new Error("Failed to fetch weather data");const n=await e.json();console.log("weatherData: ",n),Array.isArray(n)&&n.length>0?(S(n[0]),T(n.slice(1))):console.error("Unexpected weatherData format:",n)}catch(e){console.error("Error fetching weather:",e),alert("Unable to fetch weather data. Please try again.")}},I=async()=>{try{const t=await fetch("/api/weather/history",{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch search history");return await t.json()}catch(t){return console.error("Error fetching search history:",t),[]}},B=async t=>{try{if(!(await fetch(`/api/weather/history/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Failed to delete city from history")}catch(e){console.error("Error deleting city from history:",e)}},S=t=>{if(!t){console.error("No currentWeather data provided");return}const{city:e,date:n,icon:c,iconDescription:r,tempF:o,windSpeed:a,humidity:s}=t;p.textContent=`${e} (${n})`,l.setAttribute("src",`https://openweathermap.org/img/w/${c}.png`),l.setAttribute("alt",r),l.setAttribute("class","weather-img"),p.append(l),E.textContent=`Temp: ${o}°F`,g.textContent=`Wind: ${a} MPH`,w.textContent=`Humidity: ${s} %`,u&&(u.innerHTML="",u.append(p,E,g,w))},T=t=>{if(!t||t.length===0){console.error("No forecast data provided");return}const e=document.createElement("div"),n=document.createElement("h4");e.setAttribute("class","col-12"),n.textContent="5-Day Forecast:",e.append(n),d&&(d.innerHTML="",d.append(e)),t.forEach(c=>H(c))},H=t=>{if(!t){console.error("No forecast data provided");return}const{date:e,icon:n,iconDescription:c,tempF:r,windSpeed:o,humidity:a}=t,{col:s,cardTitle:L,weatherIcon:y,tempEl:C,windEl:v,humidityEl:x}=D();L.textContent=e,y.setAttribute("src",`https://openweathermap.org/img/w/${n}.png`),y.setAttribute("alt",c),C.textContent=`Temp: ${r} °F`,v.textContent=`Wind: ${o} MPH`,x.textContent=`Humidity: ${a} %`,d&&d.append(s)},A=async t=>{if(!t||t.length===0){console.error("No search history data provided");return}if(i)if(i.innerHTML="",!t.length)i.innerHTML='<p class="text-center">No Previous Search History</p>';else for(let e=t.length-1;e>=0;e--){const n=O(t[e]);i.append(n)}},D=()=>{const t=document.createElement("div"),e=document.createElement("div"),n=document.createElement("div"),c=document.createElement("h5"),r=document.createElement("img"),o=document.createElement("p"),a=document.createElement("p"),s=document.createElement("p");return t.append(e),e.append(n),n.append(c,r,o,a,s),t.classList.add("col-auto"),e.classList.add("forecast-card","card","text-white","bg-primary","h-100"),n.classList.add("card-body","p-2"),c.classList.add("card-title"),o.classList.add("card-text"),a.classList.add("card-text"),s.classList.add("card-text"),{col:t,cardTitle:c,weatherIcon:r,tempEl:o,windEl:a,humidityEl:s}},F=t=>{const e=document.createElement("button");return e.setAttribute("type","button"),e.setAttribute("aria-controls","today forecast"),e.classList.add("history-btn","btn","btn-secondary","col-10"),e.textContent=t,e},N=()=>{const t=document.createElement("button");return t.setAttribute("type","button"),t.classList.add("fas","fa-trash-alt","delete-city","btn","btn-danger","col-2"),t.addEventListener("click",j),t},$=()=>{const t=document.createElement("div");return t.classList.add("display-flex","gap-2","col-12","m-1"),t},O=t=>{const e=F(t.name),n=N();n.dataset.city=JSON.stringify(t);const c=$();return c.append(e,n),c},P=t=>{t.preventDefault();const e=f.value.trim();if(!e){alert("City cannot be blank");return}b(e).then(()=>{m()}),f.value=""},M=t=>{if(t.target instanceof HTMLButtonElement&&t.target.matches(".history-btn")){const e=t.target.textContent;e&&b(e).then(m)}},j=t=>{t.stopPropagation();const e=t.target.dataset.city;e&&B(JSON.parse(e).id).then(m)},m=()=>I().then(A);h==null||h.addEventListener("submit",P);i==null||i.addEventListener("click",M);m();
